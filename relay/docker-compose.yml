version: '3.8'

services:
  bubocore-relay:
    build: .
    container_name: bubocore-relay
    restart: unless-stopped
    ports:
      - "9090:9090"
    environment:
      - RUST_LOG=info
    networks:
      - bubocore-network
    # Resource limits
    deploy:
      resources:
        limits:
          memory: 256M
          cpus: '0.5'
        reservations:
          memory: 128M
          cpus: '0.1'
    # Health check
    healthcheck:
      test: ["CMD", "timeout", "5", "bash", "-c", "</dev/tcp/localhost/9090"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    # Logging
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

networks:
  bubocore-network:
    driver: bridge

# Optional: Add monitoring with Prometheus
# Uncomment if you want metrics
# prometheus:
#   image: prom/prometheus:latest
#   container_name: bubocore-prometheus
#   restart: unless-stopped
#   ports:
#     - "9091:9090"
#   volumes:
#     - ./prometheus.yml:/etc/prometheus/prometheus.yml
#   networks:
#     - bubocore-network